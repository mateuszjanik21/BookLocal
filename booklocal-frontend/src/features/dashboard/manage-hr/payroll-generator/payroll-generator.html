<div class="card bg-base-100 shadow-xl border border-base-200 mt-8">
  <div class="card-body">
    <h2 class="card-title text-2xl mb-4">Listy Płac i Wynagrodzenia</h2>

    <div class="bg-base-200 p-4 rounded-lg mb-6">
        <h3 class="font-bold text-lg mb-4">Generuj Listę Płac</h3>
        <form [formGroup]="generateForm" (ngSubmit)="onGenerate()" class="flex flex-col md:flex-row gap-4 items-end">
            <div class="form-control w-full md:w-1/3">
                <label class="label"><span class="label-text">Pracownik</span></label>
                <select class="select select-bordered" formControlName="employeeId">
                    <option [ngValue]="null" disabled>Wybierz pracownika</option>
                    @for(emp of employees; track emp.id) {
                        <option [value]="emp.id">{{ emp.firstName }} {{ emp.lastName }}</option>
                    }
                </select>
            </div>
            <div class="form-control w-full md:w-1/4">
                <label class="label"><span class="label-text">Miesiąc</span></label>
                <select class="select select-bordered" formControlName="month">
                    @for(m of months; track m.value) {
                        <option [value]="m.value">{{ m.label }}</option>
                    }
                </select>
            </div>
            <div class="form-control w-full md:w-1/4">
                <label class="label"><span class="label-text">Rok</span></label>
                <input type="number" class="input input-bordered" formControlName="year" />
            </div>
            <button type="submit" class="btn btn-secondary w-full md:w-auto" [disabled]="generateForm.invalid || isGenerating">
                <span *ngIf="isGenerating" class="loading loading-spinner"></span>
                Generuj
            </button>
        </form>
    </div>

    <div class="flex justify-between items-center mb-4">
        <h3 class="font-bold text-lg">Historia Wypłat</h3>
        <form [formGroup]="filterForm" (change)="loadPayrolls()" class="flex gap-2">
             <select class="select select-sm select-bordered" formControlName="month">
                <option [ngValue]="undefined">Wszystkie miesiące</option>
                @for(m of months; track m.value) {
                    <option [value]="m.value">{{ m.label }}</option>
                }
            </select>
            <input type="number" class="input input-sm input-bordered w-24" formControlName="year" />
            <button type="button" class="btn btn-sm btn-ghost" (click)="loadPayrolls()">Odśwież</button>
        </form>
    </div>

    <div class="overflow-x-auto">
        <table class="table w-full">
            <thead>
                <tr>
                    <th>Pracownik</th>
                    <th>Okres</th>
                    <th>Brutto</th>
                    <th>Netto (do wypłaty)</th>
                    <th>Koszt Pracodawcy</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                @for(payroll of payrolls; track payroll.payrollId) {
                    <tr class="hover">
                        <td>{{ payroll.employeeName }}</td>
                        <td>{{ payroll.periodMonth }}/{{ payroll.periodYear }}</td>
                        <td>{{ payroll.grossAmount | number:'1.2-2' }} zł</td>
                        <td class="font-bold text-success">{{ payroll.netAmount | number:'1.2-2' }} zł</td>
                        <td class="text-base-content/70">{{ payroll.totalEmployerCost | number:'1.2-2' }} zł</td>
                        <td>
                            <div class="badge badge-outline">{{ getStatusLabel(payroll.status) }}</div>
                        </td>
                    </tr>
                } @empty {
                    <tr>
                        <td colspan="6" class="text-center py-4">Brak list płac dla wybranych kryteriów.</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
  </div>
</div>
