<div class="card bg-base-100 shadow-xl border border-base-200 mt-8">
  <div class="card-body">
    <div class="flex flex-col sm:flex-row justify-between sm:items-center gap-3 mb-6">
      <div>
        <h2 class="card-title text-2xl">Listy Płac</h2>
        <p class="text-sm text-base-content/60 mt-0.5">Kliknij wiersz, aby przejść do szczegółów finansowych pracownika.</p>
      </div>
      <div class="flex flex-col sm:flex-row gap-2 w-full sm:w-auto">
        <button class="btn btn-secondary w-full sm:w-auto" (click)="generatePayroll()" [disabled]="isGenerating || !filterMonth || !filterYear">
          @if (isGenerating) { <span class="loading loading-spinner loading-xs mr-2"></span> }
          Generuj dla obecnych filtrów
        </button>
      </div>
    </div>

    <div class="flex flex-col lg:flex-row gap-4 mb-6 items-start lg:items-center bg-base-200/50 p-4 rounded-xl border border-base-200">
      <div class="flex flex-col sm:flex-row gap-3 items-start sm:items-center w-full lg:w-auto">
        <p class="text-sm font-semibold shrink-0">Okres:</p>
        <select class="select select-sm select-bordered w-full sm:w-auto" [(ngModel)]="filterMonth" (ngModelChange)="loadPayrolls()">
          <option [ngValue]="undefined">Wybierz miesiąc</option>
          @for (m of availableMonths; track m.value) {
            <option [value]="m.value">{{ m.label }}</option>
          }
        </select>
        <input type="number" class="input input-sm input-bordered w-full sm:w-24" [(ngModel)]="filterYear" (ngModelChange)="loadPayrolls()" />
      </div>
      
      <div class="hidden lg:block divider lg:divider-horizontal m-0"></div>
      
      <div class="flex flex-col sm:flex-row gap-3 items-start sm:items-center w-full lg:w-auto">
        <p class="text-sm font-semibold shrink-0">Pracownik:</p>
        <select class="select select-sm select-bordered w-full" [(ngModel)]="selectedEmployeeId">
          <option [ngValue]="undefined">Wszyscy pracownicy</option>
          @for (emp of employees; track emp.id) {
            <option [value]="emp.id">{{ emp.firstName }} {{ emp.lastName }}</option>
          }
        </select>
      </div>

      <div class="hidden lg:block divider lg:divider-horizontal m-0"></div>

      <div class="flex flex-col sm:flex-row gap-3 items-start sm:items-center w-full lg:w-auto">
        <p class="text-sm font-semibold shrink-0" title="Pole opcjonalne. Pozwala wygenerować płacę proporcjonalną do danego dnia.">Licz do dnia:</p>
        <input type="number" placeholder="DD" class="input input-sm input-bordered w-full sm:w-20" [(ngModel)]="filterDay" min="1" max="31" />
      </div>
    </div>

    @if (isLoading) {
      <div class="flex justify-center py-8"><span class="loading loading-spinner loading-md"></span></div>
    } @else {
      <div class="sm:hidden space-y-3">
        @for (p of payrolls; track p.payrollId) {
          <div class="rounded-xl border border-base-200 p-4 cursor-pointer hover:border-primary/50 hover:bg-base-200/40 transition-colors"
            [routerLink]="['/dashboard/employees', p.employeeId]"
            [queryParams]="{tab: 'finance'}">
            <div class="flex justify-between items-start gap-2 mb-2">
              <div>
                <p class="font-bold">{{ p.employeeName }}</p>
                <p class="text-xs text-base-content/60">{{ p.periodMonth }}/{{ p.periodYear }}</p>
              </div>
              <div class="flex items-center gap-2">
                <span class="badge badge-sm badge-outline">{{ getStatusLabel(p.status) }}</span>
                <button class="btn btn-ghost btn-xs text-error -mr-2"
                  (click)="deletePayroll($event, p)" [disabled]="isDeleting[p.payrollId]" title="Usuń listę płac">
                  @if (isDeleting[p.payrollId]) {
                    <span class="loading loading-spinner loading-xs"></span>
                  } @else {
                    Usuń
                  }
                </button>
              </div>
            </div>
            <div class="grid grid-cols-3 gap-2 text-sm">
              <div>
                <p class="text-xs text-base-content/50">Brutto</p>
                <p class="font-semibold">{{ p.grossAmount | number:'1.0-0' }} zł</p>
              </div>
              <div>
                <p class="text-xs text-base-content/50">Netto</p>
                <p class="font-semibold text-success">{{ p.netAmount | number:'1.0-0' }} zł</p>
              </div>
              <div>
                <p class="text-xs text-base-content/50">Koszt prac.</p>
                <p class="font-semibold text-error">{{ p.totalEmployerCost | number:'1.0-0' }} zł</p>
              </div>
            </div>
          </div>
        } @empty {
          <div class="text-center py-8 text-base-content/40">
            <p>Brak list płac dla wybranych kryteriów.</p>
          </div>
        }
      </div>

      <div class="hidden sm:block overflow-x-auto">
        <table class="table w-full">
          <thead>
            <tr>
              <th>Pracownik</th>
              <th>Okres</th>
              <th>Brutto</th>
              <th>Netto (do wypłaty)</th>
              <th>Koszt Pracodawcy</th>
              <th>Status</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            @for (p of payrolls; track p.payrollId) {
              <tr class="hover cursor-pointer"
                [routerLink]="['/dashboard/employees', p.employeeId]"
                [queryParams]="{tab: 'finance'}">
                <td class="font-bold">{{ p.employeeName }}</td>
                <td>{{ p.periodMonth }}/{{ p.periodYear }}</td>
                <td>{{ p.grossAmount | number:'1.2-2' }} zł</td>
                <td class="font-bold text-success">{{ p.netAmount | number:'1.2-2' }} zł</td>
                <td class="text-error">{{ p.totalEmployerCost | number:'1.2-2' }} zł</td>
                <td><span class="badge badge-sm badge-outline">{{ getStatusLabel(p.status) }}</span></td>
                <td class="text-right">
                  <button class="btn btn-ghost btn-xs text-error" title="Usuń listę płac"
                    (click)="deletePayroll($event, p)" [disabled]="isDeleting[p.payrollId]">
                    @if (isDeleting[p.payrollId]) {
                      <span class="loading loading-spinner loading-xs"></span>
                    } @else {
                      Usuń
                    }
                  </button>
                </td>
              </tr>
            } @empty {
              <tr>
                <td colspan="7" class="text-center py-6 text-base-content/40">Brak list płac.</td>
              </tr>
            }
          </tbody>
        </table>
      </div>

    }
  </div>
</div>
