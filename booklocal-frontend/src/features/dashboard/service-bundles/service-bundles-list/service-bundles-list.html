<div class="min-h-screen bg-base-200/30 p-4 sm:p-6 lg:p-8">
  <div class="max-w-[1920px] mx-auto"> <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8">
      <div>
        <h1 class="text-3xl font-bold text-base-content tracking-tight">Pakiety Usług</h1>
        <p class="text-base-content/70 mt-1">Zarządzaj ofertami specjalnymi dla Twoich klientów</p>
      </div>

      <button class="btn btn-primary w-full sm:w-auto shadow-lg shadow-primary/20 hover:shadow-primary/40 transition-all" routerLink="create">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-1">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
        </svg>
        Nowy Pakiet
      </button>
    </div>

    @if(isLoading) {
      <div class="grid grid-cols-1 sm:grid-cols-[repeat(auto-fill,minmax(320px,1fr))] gap-6">
        @for(i of [1,2,3,4,5,6]; track i) {
          <div class="card bg-base-100 shadow-xl border border-base-200 h-[450px] animate-pulse">
            <div class="h-56 bg-base-200 w-full rounded-t-2xl"></div>
            <div class="card-body p-5">
              <div class="h-7 bg-base-200 rounded w-3/4 mb-4"></div>
              <div class="h-4 bg-base-200 rounded w-full mb-2"></div>
              <div class="h-4 bg-base-200 rounded w-2/3 mb-6"></div>
              <div class="mt-auto flex justify-between pt-4">
                <div class="h-8 w-20 bg-base-200 rounded-lg"></div>
                <div class="h-8 w-10 bg-base-200 rounded-full"></div>
              </div>
            </div>
          </div>
        }
      </div>
    } @else {

      @if(bundles.length === 0) {
        <div class="flex flex-col items-center justify-center py-24 bg-base-100 rounded-3xl border-2 border-dashed border-base-300 shadow-sm text-center">
          <div class="w-24 h-24 bg-primary/10 rounded-full flex items-center justify-center mb-6">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-12 h-12 text-primary">
              <path stroke-linecap="round" stroke-linejoin="round" d="M21 11.25v8.25a1.5 1.5 0 01-1.5 1.5H4.5a1.5 1.5 0 01-1.5-1.5v-8.25M12 4.875A2.625 2.625 0 109.375 7.5H12m0-2.625V7.5m0-2.625A2.625 2.625 0 1114.625 7.5H12m0 0V21m-8.625-9.75h18c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125h-18c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z" />
            </svg>
          </div>
          <h3 class="text-2xl font-bold mb-2">Brak pakietów usług</h3>
          <p class="text-base-content/60 max-w-md mb-8">Stwórz pierwszy pakiet, aby zacząć sprzedaż łączoną.</p>
          <button class="btn btn-primary px-8" routerLink="create">Utwórz Pakiet</button>
        </div>
      }

      <div class="grid grid-cols-1 sm:grid-cols-[repeat(auto-fill,minmax(320px,1fr))] gap-6">
        
        @for(bundle of bundles; track bundle.serviceBundleId) {
          <div class="card bg-base-100 shadow-md hover:shadow-2xl hover:-translate-y-1 transition-all duration-300 border border-base-200 flex flex-col h-full group overflow-hidden">
            
            <figure class="h-56 relative bg-base-200 overflow-hidden shrink-0">
              @if(bundle.photoUrl) {
                <img [src]="bundle.photoUrl" 
                     class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" 
                     alt="{{bundle.name}}" />
              } @else {
                <div class="w-full h-full flex items-center justify-center text-base-content/20 bg-base-200/50">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                </div>
              }

              <div class="absolute bottom-0 right-0 p-3">
                 <div class="badge badge-lg bg-base-100/90 backdrop-blur text-base-content font-bold shadow-sm border-0 px-3 py-4 text-lg">
                   {{ bundle.totalPrice }} zł
                 </div>
              </div>
            </figure>

            <div class="card-body p-5 flex flex-col flex-grow">
              
              <div class="flex justify-between items-start gap-2 mb-2">
                 <h2 class="card-title text-xl font-bold leading-tight hover:text-primary transition-colors cursor-pointer" [routerLink]="['edit', bundle.serviceBundleId]">
                   {{ bundle.name }}
                 </h2>
                 <div class="tooltip tooltip-left" [attr.data-tip]="bundle.isActive ? 'Pakiet aktywny' : 'Pakiet ukryty'">
                    <span class="w-3 h-3 rounded-full block mt-2" 
                          [class.bg-success]="bundle.isActive" 
                          [class.bg-error]="!bundle.isActive"
                          [class.animate-pulse]="bundle.isActive"></span>
                 </div>
              </div>

              <p class="text-base-content/70 text-sm line-clamp-2 min-h-[2.5rem] mb-4">
                {{ bundle.description || 'Brak opisu.' }}
              </p>

              <div class="flex flex-wrap gap-2 mb-6 content-start flex-grow">
                @for(item of bundle.items.slice(0, 3); track item.serviceBundleItemId) {
                  <div class="badge badge-outline border-base-content/20 text-xs py-3 px-3 bg-base-100">
                    {{ item.serviceName }}
                  </div>
                }
                @if(bundle.items.length > 3) {
                  <span class="text-xs text-base-content/50 font-medium self-center ml-1">
                    +{{ bundle.items.length - 3 }} więcej
                  </span>
                }
              </div>

              <div class="mt-auto pt-4 border-t border-base-200 flex items-center justify-between">
                
                <label class="label cursor-pointer gap-2 p-0 hover:opacity-80">
                   <input type="checkbox" class="toggle toggle-sm toggle-success" [checked]="bundle.isActive" (change)="toggleActive(bundle)" />
                   <span class="text-xs font-semibold opacity-60">DOSTĘPNY</span>
                </label>

                <button class="btn btn-sm btn-ghost text-primary hover:bg-primary/10" [routerLink]="['edit', bundle.serviceBundleId]">
                  Edytuj
                </button>
              </div>
            </div>
          </div>
        }
      </div>
    }
  </div>
</div>