<div class="modal modal-bottom sm:modal-middle" [class.modal-open]="isVisible" (click)="closeModal($event)">
  <div class="modal-box p-0 w-full sm:w-11/12 max-w-lg animated-modal scrollbar-hide">
    
    <div class="modal-header p-4 sm:p-6 bg-base-100 border-b border-base-200 flex items-center gap-4 sticky top-0 z-10">
      <div class="bg-primary/10 rounded-full p-2 text-primary shrink-0">
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
  </svg>
</div>
      <div class="min-w-0">
        <h3 class="font-bold text-lg leading-tight">{{ variant ? 'Edytuj Wariant' : 'Nowy Wariant' }}</h3>
        <p class="text-xs sm:text-sm text-base-content/60 truncate">Usługa: <span class="font-semibold">{{ service?.name }}</span></p>
      </div>
      <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2 sm:right-4 sm:top-4" (click)="closed.emit(false)">✕</button>
    </div>

    <form [formGroup]="variantForm" (ngSubmit)="onSubmit()" class="p-4 sm:p-6 space-y-5">
      
      <div class="form-control">
        <label class="label pt-0"><span class="label-text font-medium">Nazwa wariantu</span></label>
        <input type="text" placeholder="np. Włosy długie" class="input input-bordered w-full" 
               formControlName="name"
               [class.input-error]="variantForm.get('name')?.invalid && variantForm.get('name')?.touched" />
        @if(variantForm.get('name')?.invalid && variantForm.get('name')?.touched) {
          <span class="text-xs text-error mt-1">Nazwa jest wymagana.</span>
        }
      </div>

      <div class="grid grid-cols-2 gap-4">
        
        <div class="form-control">
          <label class="label pt-0"><span class="label-text font-medium">Cena</span></label>
          <div class="relative">
            <input type="number" class="input input-bordered w-full pr-10 font-mono" placeholder="0" formControlName="price"
                   [class.input-error]="variantForm.get('price')?.invalid && variantForm.get('price')?.touched" />
            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-base-content/50 text-sm">zł</div>
          </div>
          @if(variantForm.get('price')?.hasError('required') && variantForm.get('price')?.touched) {
            <span class="text-xs text-error mt-1">Wymagane.</span>
          }
        </div>

        <div class="form-control">
          <label class="label pt-0"><span class="label-text font-medium">Czas</span></label>
          <div class="relative">
            <input type="number" class="input input-bordered w-full pr-10 font-mono" placeholder="30" formControlName="durationMinutes"
                   [class.input-error]="variantForm.get('durationMinutes')?.invalid && variantForm.get('durationMinutes')?.touched" />
            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-base-content/50 text-sm">min</div>
          </div>
          @if(variantForm.get('durationMinutes')?.hasError('required') && variantForm.get('durationMinutes')?.touched) {
            <span class="text-xs text-error mt-1">Wymagane.</span>
          }
        </div>

        <div class="form-control col-span-2">
           <label class="label pt-0 cursor-pointer justify-start gap-2">
             <span class="label-text font-medium">Czas techniczny (sprzątanie)</span>
             <div class="tooltip tooltip-right z-20" data-tip="Czas po wizycie blokujący kalendarz">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-info w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
             </div>
           </label>
           <div class="relative">
             <input type="number" class="input input-bordered w-full pr-10" placeholder="0" formControlName="cleanupTimeMinutes" />
             <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-base-content/50 text-sm">min</div>
           </div>
        </div>
      </div>

      <div class="modal-action border-t border-base-200 pt-4 mt-6">
        <button type="button" class="btn btn-ghost" (click)="closed.emit(false)">Anuluj</button>
        <button type="button" class="btn btn-primary px-8" [disabled]="variantForm.invalid" (click)="onSubmit()">
          @if(isSubmitting) { <span class="loading loading-spinner loading-sm"></span> }
          @else { Zapisz }
        </button>
      </div>
    </form>
  </div>
</div>