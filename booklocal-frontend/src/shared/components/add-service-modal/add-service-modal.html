<div class="modal modal-bottom sm:modal-middle" [class.modal-open]="isVisible" (click)="closeModal($event)">
  <div class="modal-box p-0 w-full sm:w-11/12 max-w-lg animated-modal scrollbar-hide">
    
    <div class="modal-header p-4 sm:p-6 bg-base-100 border-b border-base-200 flex items-center gap-4 sticky top-0 z-10">
      <div class="bg-primary/10 rounded-full p-2 text-primary shrink-0">
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
  </svg>
</div>
      <div>
        <h3 class="font-bold text-lg leading-tight">Nowa Usługa</h3>
        <p class="text-xs sm:text-sm text-base-content/60">Zdefiniuj usługę i podstawowy cennik.</p>
      </div>
      <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2 sm:right-4 sm:top-4" (click)="closed.emit(false)">✕</button>
    </div>

    <form [formGroup]="serviceForm" class="p-4 sm:p-6 space-y-5">
      <div class="form-control">
        <label class="label pt-0"><span class="label-text font-medium">Nazwa usługi</span></label>
        <input type="text" placeholder="np. Strzyżenie damskie" class="input input-bordered w-full" 
               formControlName="name" 
               [class.input-error]="serviceForm.get('name')?.invalid && serviceForm.get('name')?.touched" />
        @if(serviceForm.get('name')?.invalid && serviceForm.get('name')?.touched) {
          <span class="text-xs text-error mt-1">Wymagane.</span>
        }
      </div>

      <div class="form-control">
        <label class="label pt-0"><span class="label-text font-medium">Opis (opcjonalnie)</span></label>
        <textarea class="textarea textarea-bordered w-full h-20" placeholder="Krótki opis..." formControlName="description"></textarea>
      </div>

      <div class="bg-base-200/50 rounded-xl p-4 border border-base-200">
        <div class="flex items-center gap-2 mb-3 text-base-content/80">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" /></svg>
            <span class="text-xs font-bold uppercase tracking-wider">Cennik Podstawowy</span>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div class="form-control">
            <label class="label pt-0"><span class="label-text font-medium text-xs sm:text-sm">Cena</span></label>
            <div class="relative">
              <input type="number" placeholder="0" class="input input-bordered w-full pr-8 font-mono text-sm sm:text-base" 
                     formControlName="price"
                     [class.input-error]="serviceForm.get('price')?.invalid && serviceForm.get('price')?.touched" />
              <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-base-content/50 text-xs">zł</div>
            </div>
            @if(serviceForm.get('price')?.hasError('required') && serviceForm.get('price')?.touched) {
               <span class="text-[10px] text-error">Wymagane</span>
            }
          </div>

          <div class="form-control">
            <label class="label pt-0"><span class="label-text font-medium text-xs sm:text-sm">Czas</span></label>
            <div class="relative">
              <input type="number" placeholder="30" class="input input-bordered w-full pr-8 font-mono text-sm sm:text-base" 
                     formControlName="durationMinutes"
                     [class.input-error]="serviceForm.get('durationMinutes')?.invalid && serviceForm.get('durationMinutes')?.touched" />
              <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-base-content/50 text-xs">min</div>
            </div>
            @if(serviceForm.get('durationMinutes')?.hasError('required') && serviceForm.get('durationMinutes')?.touched) {
               <span class="text-[10px] text-error">Wymagane</span>
            }
          </div>

          <div class="form-control col-span-2">
             <label class="label pt-0 cursor-pointer justify-start gap-1">
               <span class="label-text font-medium text-xs sm:text-sm">Czas sprzątania</span>
               <div class="tooltip tooltip-right z-20" data-tip="Blokada kalendarza po wizycie">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-info w-3 h-3"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
               </div>
             </label>
             <div class="relative">
               <input type="number" placeholder="0" class="input input-bordered w-full pr-8 text-sm sm:text-base" formControlName="cleanupTimeMinutes" />
               <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-base-content/50 text-xs">min</div>
             </div>
          </div>
        </div>
      </div>
      
      <div class="modal-action border-t border-base-200 pt-4 mt-6">
        <button type="button" class="btn btn-ghost" (click)="closed.emit(false)">Anuluj</button>
        <button type="button" class="btn btn-primary px-8" [disabled]="serviceForm.invalid" (click)="onSubmit()">
          @if(isSubmitting) { <span class="loading loading-spinner loading-sm"></span> }
          @else { Dodaj }
        </button>
      </div>
    </form>
  </div>
</div>