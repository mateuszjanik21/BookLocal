<div class="modal" [class.modal-open]="isVisible">
  <div class="modal-box max-w-lg">
    <h3 class="font-bold text-2xl mb-1">{{ isEditMode ? 'Edytuj Kategorię' : 'Dodaj Nową Kategorię' }}</h3>
    <p class="text-base-content/70 mb-6">Uzupełnij dane, aby stworzyć lub zaktualizować kategorię w swojej ofercie.</p>
    
    <form [formGroup]="categoryForm" (ngSubmit)="onSubmit()" class="space-y-6">
      <div>
        <label class="label"><span class="label-text font-semibold">Kategoria główna</span></label>
        <select class="select select-bordered w-full" formControlName="mainCategoryId">
          <option [ngValue]="null" disabled>Wybierz z listy...</option>
          @if(mainCategories$ | async; as mainCategories) {
            @for(mainCat of mainCategories; track mainCat.mainCategoryId) {
              <option [value]="mainCat.mainCategoryId">{{ mainCat.name }}</option>
            }
          }
        </select>
      </div>

      <div>
        <label class="label"><span class="label-text font-semibold">Nazwa własna kategorii</span></label>
        <input type="text" placeholder="np. &quot;Strzyżenie&quot;, &quot;Koloryzacja&quot;, &quot;Pielęgnacja&quot;." class="input input-bordered w-full" formControlName="name" />
      </div>

      <div>
        <label class="label"><span class="label-text font-semibold">Zdjęcie kategorii</span></label>
        <p class="text-xs text-base-content/60 mt-1 mb-3">Profesjonalne zdjęcie przyciągnie uwagę klientów.</p>

        <app-image-upload 
          [currentImageUrl]="category?.photoUrl"
          [isLoading]="isLoading"
          [showUploadButton]="false"
          displayStyle="circle"
          (imageSelected)="onImageSelected($event)">
        </app-image-upload>
      </div>

      <div class="modal-action mt-8 border-t border-base-200 pt-6">
        <button type="button" class="btn btn-ghost" (click)="closed.emit()">Anuluj</button>
        <button type="button" class="btn btn-primary" [disabled]="categoryForm.invalid || isLoading" (click)="onSubmit()">
          @if(isLoading){ <span class="loading loading-spinner"></span> }
          Zapisz zmiany
        </button>
      </div>
    </form>
  </div>
</div>